var vid=document.getElementById("vid");var chart=document.getElementById("chart");var currentTime=document.getElementById("currentTime");var existingRanges=[];var timeline=document.getElementById("timeline");var timelineWrapper=document.getElementById("timeline-wrapper");var sliderWrapper=document.getElementById("slider-wrapper");var btn_play=document.getElementById("btn_play");var bar=document.getElementById("myBar");var pseudo=document.getElementById("pseudoTimeline");var width=11*(vid.clientWidth/12);var height=sliderWrapper.clientHeight;var array=[];$(document).ready(function(){});window.onload=function(){console.log("onloadされました.");bar.width=0;vid.volume=0.5;drawBar();showIndicator();post(5);};vid.ondurationchange=function(){console.log("durationが変更されました.");bar.width=0;vid.volume=0.5;drawBar();showIndicator();post(5);};$(window).resize(function(){console.log("resizeされました．");drawBar();drawHeatmap();});function drawBar(){console.log(vid.clientWidth);width=11*(vid.clientWidth/12);height=sliderWrapper.clientHeight;console.log(width);console.log(height);timeline.width=width;timeline.height=height;bar.height=height;pseudo.width=width;pseudo.height=height;}btn_play.addEventListener("click",video_play,false);function video_play(){if(vid.paused){vid.play();btn_play.src="img/btn_pause.png";}else{vid.pause();btn_play.src="img/btn_play.png";}}setInterval("update()",10);function update(){var e=vid.currentTime;var b=vid.duration;var a=e/b;bar.width=a*width;bar.height=height;}function onClick(b){var a=b.target.getBoundingClientRect();x=b.clientX-a.left;y=b.clientY-a.top;vid.currentTime=vid.duration*(x/width);}pseudo.addEventListener("click",onClick,false);$("#vUiSlider").slider({orientation:"vertical",range:"min",max:10,value:5,animate:true,slide:function(a,b){$("#slideValue").text(b.value);}});$("#vUiSlider").slider({change:function(a,b){console.log(b.value);showIndicator();post(b.value);}});$("#volumeSlider").slider({range:"min",max:10,value:5,animate:true,});$("#volumeSlider").slider({change:function(a,b){changeVolume(b.value);}});function changeVolume(a){vid.volume=a/10;}function drawHeatmap(){var a=timeline.getContext("2d");a.clearRect(0,0,width,height);console.log("array",array);console.log(vid.duration);for(var b=0;b<array.length;b++){start=(array[b]/vid.duration)*width;a.beginPath();a.moveTo(start,0);a.lineTo(start,height);a.lineWidth=2;a.strokeStyle="#f00";a.globalAlpha=0.1;a.stroke();}}function showIndicator(){$("#indicator").tiktok({type:"popload",content:{title:"Please Wait...",content:"Please reload if loading takes more than 1 minute."}});$("#indicator").tiktok("show");}function hideIndicator(){$("#indicator").tiktok("hide");drawHeatmap();}function post(b){console.log("Posting");var a={};a.threshold=b;var c=new XMLHttpRequest();c.open("POST","http://iuidemo.japaneast.cloudapp.azure.com:8050/upload_file",true);c.setRequestHeader("Content-type","application/json");c.send(JSON.stringify(a));console.log(c);c.onloadstart=function(){console.log("通信開始");};c.onload=function(f){var d=JSON.parse(c.responseText);array=d.times;setTimeout(hideIndicator,1000);};c.onerror=function(){console.log("通信エラー");};c.onabort=function(){console.log("Abort");};c.ontimeout=function(){console.log("タイムアウト");};}var modal=document.getElementById("myModal");var img=document.getElementById("myImg");var img2=document.getElementById("myImg2");var modalImg=document.getElementById("img01");var captionText=document.getElementById("caption");img.onclick=function(){modal.style.display="block";modalImg.src=this.src;captionText.innerHTML=this.alt;};img2.onclick=function(){modal.style.display="block";modalImg.src=this.src;captionText.innerHTML=this.alt;};var span=document.getElementsByClassName("close")[0];span.onclick=function(){modal.style.display="none";};